syntax = "proto3";

package tools.teal.pulsar.ui.library.v1;

import "google/protobuf/timestamp.proto";
import "tools/teal/pulsar/ui/api/v1/consumer.proto";

enum UserManagedItemType {
  USER_MANAGED_ITEM_TYPE_UNSPECIFIED = 0;

  USER_MANAGED_ITEM_TYPE_CONSUMER_SESSION_CONFIG = 1;
  USER_MANAGED_ITEM_TYPE_CONSUMER_SESSION_START_FROM = 11;
  USER_MANAGED_ITEM_TYPE_CONSUMER_SESSION_PAUSE_TRIGGER = 12;

  USER_MANAGED_ITEM_TYPE_MESSAGE_FILTER = 4;
  USER_MANAGED_ITEM_TYPE_MESSAGE_FILTER_CHAIN = 5;

  USER_MANAGED_ITEM_TYPE_PRODUCER_SESSION_CONFIG = 2;

  USER_MANAGED_ITEM_TYPE_MARKDOWN_DOCUMENT = 3;

  USER_MANAGED_ITEM_TYPE_DATA_VISUALIZATION_WIDGET = 6;
  USER_MANAGED_ITEM_TYPE_DATA_VISUALIZATION_DASHBOARD = 7;

  USER_MANAGED_ITEM_TYPE_MESSAGE_ID = 8;
  USER_MANAGED_ITEM_TYPE_DATE_TIME = 9;
  USER_MANAGED_ITEM_TYPE_RELATIVE_DATE_TIME = 10;
}

message UserManagedItemMetadata {
  UserManagedItemType type = 1;
  string id = 2;
  string name = 6;
  string description_markdown = 7;
}

message UserManagedMessageIdSpec {
  bytes message_id = 2;
}

message UserManagedMessageId {
  UserManagedItemMetadata metadata = 1;
  UserManagedMessageIdSpec spec = 2;
}

message UserManagedMessageIdValueOrReference {
  oneof message_id {
    UserManagedMessageId message_id_value = 1;
    string message_id_reference = 2;
  }
}

message UserManagedDateTimeSpec {
  google.protobuf.Timestamp date_time = 2;
}

message UserManagedDateTime {
  UserManagedItemMetadata metadata = 1;
  UserManagedDateTimeSpec spec = 2;
}

message UserManagedDateTimeValueOrReference {
  oneof date_time {
    UserManagedDateTime date_time_value = 1;
    string date_time_reference = 2;
  }
}

message UserManagedRelativeDateTimeSpec {
  int64 value = 2;
  tools.teal.pulsar.ui.api.v1.DateTimeUnit unit = 3;
  bool is_rounded_to_unit_start = 4;
}

message UserManagedRelativeDateTime {
  UserManagedItemMetadata metadata = 1;
  UserManagedRelativeDateTimeSpec spec = 2;
}

message UserManagedRelativeDateTimeValueOrReference {
  oneof relative_date_time {
    UserManagedRelativeDateTime relative_date_time_value = 1;
    string relative_date_time_reference = 2;
  }
}

message UserManagedConsumerSessionStartFromSpec {
  oneof start_from {
    tools.teal.pulsar.ui.api.v1.EarliestMessage start_from_earliest_message = 1;
    tools.teal.pulsar.ui.api.v1.LatestMessage start_from_latest_message = 2;
    tools.teal.pulsar.ui.api.v1.NthMessageAfterEarliest start_from_nth_message_after_earliest = 6;
    tools.teal.pulsar.ui.api.v1.NthMessageBeforeLatest start_from_nth_message_before_latest = 7;
    UserManagedMessageIdValueOrReference start_from_message_id = 3;
    UserManagedDateTimeValueOrReference start_from_date_time = 4;
    UserManagedRelativeDateTimeValueOrReference start_from_relative_date_time = 5;
  }
}

message UserManagedConsumerSessionStartFrom {
  UserManagedItemMetadata metadata = 1;
  UserManagedConsumerSessionStartFromSpec spec = 2;
}

message UserManagedConsumerSessionStartFromValueOrReference {
  oneof start_from {
    UserManagedConsumerSessionStartFrom start_from_value = 1;
    string start_from_reference = 2;
  }
}

message ConsumerSessionEventMessageFilterChainPassed {
  UserManagedMessageFilterChainValueOrReference message_filter_chain = 1;
}

message UserManagedConsumerSessionEventSpec {
  oneof event {
    tools.teal.pulsar.ui.api.v1.ConsumerSessionEventMessagesProcessed event_messages_processed = 1;
    tools.teal.pulsar.ui.api.v1.ConsumerSessionEventMessagesDelivered event_messages_delivered = 2;
    tools.teal.pulsar.ui.api.v1.ConsumerSessionEventBytesProcessed event_bytes_processed = 3;
    tools.teal.pulsar.ui.api.v1.ConsumerSessionEventBytesDelivered event_bytes_delivered = 4;
    tools.teal.pulsar.ui.api.v1.ConsumerSessionEventMessageDecodeFailed event_message_decode_failed = 5;
    tools.teal.pulsar.ui.api.v1.ConsumerSessionEventTimeElapsedMs event_time_elapsed_ms = 6;
    tools.teal.pulsar.ui.api.v1.ConsumerSessionEventTopicEndReached event_topic_end_reached = 7;
    tools.teal.pulsar.ui.api.v1.ConsumerSessionEventUnexpectedErrorOccurred event_unexpected_error_occurred = 8;
    ConsumerSessionEventMessageFilterChainPassed event_message_filter_chain_passed = 10;
  }
}

message UserManagedConsumerSessionEvent {
  UserManagedItemMetadata metadata = 1;
  UserManagedConsumerSessionEventSpec spec = 2;
}

message UserManagedConsumerSessionEventValueOrReference {
  oneof event {
    UserManagedConsumerSessionEvent event_value = 1;
    string event_reference = 2;
  }
}

message UserManagedConsumerSessionPauseTriggerChainSpec {
  repeated UserManagedConsumerSessionEventValueOrReference events = 1;
  tools.teal.pulsar.ui.api.v1.ConsumerSessionPauseTriggerChainMode mode = 2;
}

message UserManagedConsumerSessionPauseTriggerChain {
  UserManagedItemMetadata metadata = 1;
  UserManagedConsumerSessionPauseTriggerChainSpec spec = 2;
}

message UserManagedConsumerSessionPauseTriggerChainValueOrReference {
  oneof pause_trigger_chain {
    UserManagedConsumerSessionPauseTriggerChain pause_trigger_chain_value = 1;
    string pause_trigger_chain_reference = 2;
  }
}

message UserManagedMessageFilterSpec {
  tools.teal.pulsar.ui.api.v1.MessageFilter message_filter = 1;
}

message UserManagedMessageFilter {
  UserManagedItemMetadata metadata = 1;
  UserManagedMessageFilterSpec spec = 2;
}

message UserManagedMessageFilterValueOrReference {
  oneof message_filter {
    UserManagedMessageFilter message_filter_value = 1;
    string message_filter_reference = 2;
  }
}

message UserManagedMessageFilterChainSpec {
  bool is_enabled = 1;
  bool is_negated = 2;
  repeated UserManagedMessageFilterValueOrReference filters = 3;
  tools.teal.pulsar.ui.api.v1.MessageFilterChainMode mode = 4;
}

message UserManagedMessageFilterChain {
  UserManagedItemMetadata metadata = 1;
  UserManagedMessageFilterChainSpec spec = 2;
}

message UserManagedMessageFilterChainValueOrReference {
  oneof message_filter_chain {
    UserManagedMessageFilterChain message_filter_chain_value = 1;
    string message_filter_chain_reference = 2;
  }
}

message TopicsSelectorCurrentTopic {};

message TopicsSelectorByFqns {
  repeated string topic_fqns = 1;
  bool is_convert_partitioned_topic_to_its_partitions = 4;
}

message UserManagedTopicsSelectorSpec {
  oneof topics_selector {
    TopicsSelectorCurrentTopic topics_selector_current_topic = 3;
    tools.teal.pulsar.ui.api.v1.TopicsSelectorSingleTopic topics_selector_single_topic = 1;
    tools.teal.pulsar.ui.api.v1.TopicsSelectorByNamespacedRegex topics_selector_by_namespaced_regex = 2;
  }
}

message UserManagedTopicsSelector {
  UserManagedItemMetadata metadata = 1;
  UserManagedTopicsSelectorSpec spec = 2;
}

message UserManagedTopicsSelectorValueOrReference {
  oneof topics_selector {
    UserManagedTopicsSelector topics_selector_value = 1;
    string topics_selector_reference = 2;
  }
}

message UserManagedConsumerSessionConsumerSpec {
  UserManagedTopicsSelector topic_selector = 4;
  UserManagedConsumerSessionStartFromValueOrReference start_from = 1;
  UserManagedMessageFilterChainValueOrReference message_filter_chain = 2;
  UserManagedConsumerSessionPauseTriggerChainValueOrReference pause_trigger_chain = 3;
}

message UserManagedConsumerSessionConsumer {
  UserManagedItemMetadata metadata = 1;
  UserManagedConsumerSessionConsumerSpec spec = 2;
}

message UserManagedItem {
  oneof item {
    UserManagedConsumerSessionConsumer consumer_session_consumer = 2;
    UserManagedTopicsSelector topics_selector = 10;
    UserManagedConsumerSessionStartFrom consumer_session_start_from = 3;
    UserManagedConsumerSessionPauseTriggerChain consumer_session_pause_trigger_chain = 4;
    UserManagedMessageId message_id = 5;
    UserManagedDateTime date_time = 6;
    UserManagedRelativeDateTime relative_date_time = 7;
    UserManagedMessageFilter message_filter = 8;
    UserManagedMessageFilterChain message_filter_chain = 9;
  }
}
