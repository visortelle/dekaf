syntax = "proto3";

package tools.teal.pulsar.ui.library.v1;

import "google/rpc/status.proto";
import "tools/teal/pulsar/ui/library/v1/resource_matchers.proto";
import "tools/teal/pulsar/ui/library/v1/user_managed_items.proto";

message LibraryItemMetadata {
  string revision = 3;
  string updated_at = 4;
  bool is_editable = 5;
  repeated string tags = 8;
  repeated ResourceMatcher resources = 9;
}

message LibraryItem {
  LibraryItemMetadata metadata = 1;

  oneof user_managed_item {
    UserManagedConsumerSessionConfig consumer_session_config = 10;
    UserManagedMessageFilter message_filter = 11;
    UserManagedMessageFilterChain message_filter_chain = 12;
  }
}

message DeleteLibraryItemRequest {
  string id = 1;
}

message DeleteLibraryItemResponse {
  google.rpc.Status status = 1;
}

message SaveLibraryItemRequest {
  LibraryItem item = 1;
}

message SaveLibraryItemResponse {
  google.rpc.Status status = 1;
}

message GetLibraryItemRequest {
  string id = 1;
}

message GetLibraryItemResponse {
  google.rpc.Status status = 1;
  LibraryItem item = 2;
}

message ListLibraryItemsRequest {
  repeated UserManagedItemType types = 1;
  repeated string resource_fqns = 2;
  repeated string tags = 3;
  string name = 5;
  string description = 6;
}

message ListLibraryItemsResponse {
  google.rpc.Status status = 1;
  repeated LibraryItem items = 2; // resource spec is ommited in response to reduce it's size
}

service LibraryService {
  rpc SaveLibraryItem(SaveLibraryItemRequest) returns (SaveLibraryItemResponse);
  rpc DeleteLibraryItem(DeleteLibraryItemRequest) returns (DeleteLibraryItemResponse);
  rpc GetLibraryItem(GetLibraryItemRequest) returns (GetLibraryItemResponse);
  rpc ListLibraryItems(ListLibraryItemsRequest) returns (ListLibraryItemsResponse);
}
