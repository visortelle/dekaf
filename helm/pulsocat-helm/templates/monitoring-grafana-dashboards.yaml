{{ if .Values.monitoring.enabled }}
{{ if .Values.monitoring.grafana.dashboards.enabled }}

{{ $root := . }}
{{ range $path, $_ :=  .Files.Glob  "grafana-dashboards/**.json" }}
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: pulsocat-{{ base $path }}
  namespace: {{ $root.Release.Namespace }}
  labels:
    {{- include "_chart-name.labels" $root | nindent 4 }}
    {{- if $root.Values.monitoring.grafana.extraLabels }}
    {{- toYaml $root.Values.monitoring.grafana.extraLabels | nindent 4 }}
    {{- end }}
  annotations:
    {{- if $root.Values.monitoring.grafana.extraAnnotations }}
    {{- toYaml $root.Values.monitoring.grafana.extraAnnotations | nindent 4 }}
    {{- end }}
spec:
  instanceSelector:
    matchLabels:
      grafana: {{ $root.Release.Name }}
  json: |
{{ $root.Files.Get $path | replace "{{ PULSAR_CLUSTER }}" "pulsocat-prometheus" | indent 4 }}
---
{{ end }}

{{ end }}
{{ end }}
